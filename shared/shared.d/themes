#!/bin/sh
# Switch between starship prompt themes
# Themes are stored as shared/themes/starship-<name>.toml in the dotfiles repo

themes() {
    local theme_dir="${DOTFILES_DIR:-${DOTFILES_TARGET:-$HOME/.epicli}}/shared/themes"
    local target="$HOME/.config/starship.toml"
    local theme_record="$HOME/.config/starship-theme"

    # No args: list available themes
    if [ -z "$1" ] || [ "$1" = "list" ] || [ "$1" = "--list" ] || [ "$1" = "-l" ]; then
        local current=""
        [ -f "$theme_record" ] && current=$(cat "$theme_record")

        echo "Available starship themes:"
        echo ""

        # Default (gruvbox rainbow)
        if [ -f "$theme_dir/starship.toml" ]; then
            if [ "$current" = "default" ] || [ "$current" = "gruvbox-rainbow" ]; then
                echo "  * gruvbox-rainbow (default) [active]"
            else
                echo "    gruvbox-rainbow (default)"
            fi
        fi

        # Named themes
        for f in "$theme_dir"/starship-*.toml; do
            [ -f "$f" ] || continue
            local name=$(basename "$f" | sed 's/^starship-//;s/\.toml$//')
            if [ "$current" = "$name" ]; then
                echo "  * $name [active]"
            else
                echo "    $name"
            fi
        done

        echo ""
        echo "Usage: themes <name>"
        return 0
    fi

    # Switch theme
    local name="$1"
    local theme_file

    if [ "$name" = "default" ] || [ "$name" = "gruvbox-rainbow" ]; then
        theme_file="$theme_dir/starship.toml"
        name="default"
    else
        theme_file="$theme_dir/starship-${name}.toml"
    fi

    if [ ! -f "$theme_file" ]; then
        echo "Theme '$name' not found."
        echo "Run 'themes' to see available themes."
        return 1
    fi

    mkdir -p "$(dirname "$target")"
    cp "$theme_file" "$target"
    echo "$name" > "$theme_record"
    echo "Switched to starship theme: $name"
}
